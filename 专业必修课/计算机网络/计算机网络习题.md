## TCP和UDP区别

**通过端口号区分二者报文**

**适用场景**：TCP文件传输或重要状态更新；UDP视频弹幕等

**连接**：TCP是面向连接的传输层协议，即传输数据之前必须先建立好连接；UDP无连接。

**服务对象**：TCP是点对点的两点间服务，即一条TCP连接只能有两个端点；UDP支持一对一，一对多，多对一，多对多的交互通信。

**可靠性**：TCP是可靠交付：无差错，不丢失，不重复，按序到达；UDP是尽最大努力交付，不保证可靠交付。

**拥塞控制，流量控制**：TCP有拥塞控制和流量控制保证数据传输的安全性；UDP没有拥塞控制，网络拥塞不会影响源主机的发送效率。

**报文长度**：TCP是动态报文长度，即TCP报文长度是根据接收方的窗口大小和当前网络拥塞情况决定的；UDP面向报文，不合并，不拆分，保留上面传下来报文的边界。

**首部开销**：TCP首部开销大，首部20个字节；UDP首部开销小，8字节。（源端口，目的端口，数据长度，校验和）

## TCP保证可靠性

**滑动窗口**

**ARQ协议**

**拥塞控制**：当网络拥塞时，减少数据的发送。解决方法：慢启动，快重传和拥塞避免。

**流量控制**：TCP 连接的每一方都有固定大小的缓冲空间，TCP的接收端只允许发送端发送接收端缓冲区能接纳的数据。当接收方来不及处理发送方的数据，能提示发送方降低发送的速率，防止包丢失。TCP 使用的流量控制协议是可变大小的滑动窗口协议。 （TCP 利用滑动窗口实现流量控制）

## TCP建立连接和断开连接的过程

**建立连接**：三次握手，客户端发送Syn = 1，seq = x给服务器端，服务器端返回seq=y，ack = x+1 ，syn=1给客户端，客户端检查ack是否为x+1，如果正确返回ack=y+1给客户端

**断开连接**：四次挥手，由于是全双工的，每个方向都需要单独关闭。数据传输结束后，客户端的应用进程发出连接释放报文段，并停止发送数据，客户端进入FIN_WAIT_1状态，此时客户端依然可以接收服务器发送来的数据。服务器接收到FIN后，发送一个ACK给客户端，确认序号为收到的序号+1，服务器进入CLOSE_WAIT状态。客户端收到后进入FIN_WAIT_2状态。当服务器没有数据要发送时，服务器发送一个FIN报文，此时服务器进入LAST_ACK状态，等待客户端的确认客户端收到服务器的FIN报文后，给服务器发送一个ACK报文，确认序列号为收到的序号+1。此时客户端进入TIME_WAIT状态，等待2MSL（MSL：报文段最大生存时间），然后关闭连接。

## 三次握手和四次挥手的原因

**三次握手**：三次握手可以防止已经失效的连接请求报文突然又传输到服务器端导致的服务器资源浪费。例如，客户端先发送了一个SYN，但是由于网络阻塞，该SYN数据包在某个节点长期滞留。然后客户端又重传SYN数据包并正确建立TCP连接，然后传输完数据后关闭该连接。该连接释放后失效的SYN数据包才到达服务器端。在二次握手的前提下，服务器端会认为这是客户端发起的又一次请求，然后发送SYN ，并且在服务器端创建socket套接字，一直等待客户端发送数据。但是由于客户端并没有发起新的请求，所以会丢弃服务端的SYN 。此时服务器会一直等待客户端发送数据从而造成资源浪费。

**四次挥手**：由于连接的关闭控制权在应用层，所以被动关闭的一方在接收到FIN包时，TCP协议栈会直接发送一个ACK确认包，优先关闭一端的通信。然后通知应用层，由应用层决定什么时候发送FIN包。应用层可以使用系统调用函数read==0来判断对端是否关闭连接。

## HTTP和HTTPS区别

**区别**：HTTP协议是以明文的方式在网络中传输数据，而HTTPS协议传输的数据则是经过TLS加密后的，HTTPS具有更高的安全性；HTTPS在TCP三次握手阶段之后，还需要进行SSL 的handshake，协商加密使用的对称加密密钥；HTTPS协议需要服务端申请证书，浏览器端安装对应的根证书；HTTP协议端口是80，HTTPS协议端口是443。

**HTTPS优点**：传输数据使用密钥加密，安全性高；可以认证用户和服务器保证正确性

**HTTPS缺点**：因为要采用ssl握手，延时高；需要购买很多证书和解密计算，对服务器配置要求高，部署成本高。

## HTTP协议

**HTTP简介**：HTTP是一个属于应用层的面向对象的协议，由于其简捷、快速的方式，适用于分布式超媒体信息系统。它于1990年提出，经过几年的使用与发展，得到不断地完善和扩展。HTTP协议工作于客户端-服务端架构为上。浏览器作为HTTP客户端通过URL向HTTP服务端即WEB服务器发送所有请求。Web服务器根据接收到的请求后，向客户端发送响应信息。

**HTTP返回码**：协议的响应报文由状态行、响应头部和响应包体组成，其响应状态码总体描述如下：

1xx：指示信息--表示请求已接收，继续处理。

2xx：成功--表示请求已被成功接收、理解、接受。

3xx：重定向--要完成请求必须进行更进一步的操作。

4xx：客户端错误--请求有语法错误或请求无法实现。

5xx：服务器端错误--服务器未能实现合法的请求。

常见状态代码、状态描述的详细说明如下。

200 OK：客户端请求成功。403 Forbidden：服务器收到请求，但是拒绝提供服务。

## IP地址和MAC地址作用

MAC地址是一个硬件地址，用来定义网络设备的位置，主要由数据链路层负责。而IP地址是IP协议提供的一种统一的地址格式，为互联网上的每一个网络和每一台主机分配一个逻辑地址，以此来屏蔽物理地址的差异。

## OSI七层模型和TCP/IP四层协议

OSI七层模型及协议

**物理层**: 通过媒介传输比特,确定机械及电气规范,传输单位为bit，主要包括的协议为：**IEE802.3** CLOCK RJ45；**数据链路层**: 将比特组装成帧和点到点的传递,传输单位为帧,主要包括的协议为**MAC** VLAN **PPP**；**网络层**：负责数据包从源到宿的传递和网际互连，传输单位为包,主要包括的协议为**IP ARP ICMP**；**传输层**：提供端到端的可靠报文传递和错误恢复，传输单位为报文,主要包括的协议为**TCP UDP**；**会话层**：建立、管理和终止会话，传输单位为SPDU，主要包括的协议为RPC NFS；**表示层**: 对数据进行翻译、加密和压缩,传输单位为PPDU，主要包括的协议为JPEG ASII；**应用层**: 允许访问OSI环境的手段,传输单位为APDU，主要包括的协议为**FTP HTTP DNS**。

TCP/IP 4层模型及协议

网络接口层：MAC VLAN；网络层:IP ARP ICMP；传输层:TCP UDP；应用层:HTTP DNS SMTP

## 搜索baidu会用到网络的什么层

浏览器输入URL，将URL解析为IP地址，需要用到DNS服务，DNS服务需要建立连接UDP，得到IP地址后浏览器与服务器建立htttp连接，TCP协议，建立连接之后需要解析MAC地址，ARP协议

应用层，传输层，网络层和数据链路层

## get和post的区别

**相同**

对于GET方式的请求，浏览器会把http header和data一并发送出去，服务器响应200（返回数据）；

而对于POST，浏览器先发送header，服务器响应100 continue，浏览器再发送data，服务器响应200 ok（返回数据）

**不同**

get参数通过url传递，post放在request body中。

get请求在url中传递的参数是有长度限制的，而post没有。

get比post更不安全，因为参数直接暴露在url中，所以不能用来传递敏感信息。

get请求只能进行url编码，而post支持多种编码方式。

get请求会浏览器主动cache，而post支持多种编码方式。

get请求参数会被完整保留在浏览历史记录里，而post中的参数不会被保留。

GET和POST本质上就是TCP链接，并无差别。但是由于HTTP的规定和浏览器/服务器的限制，导致他们在应用过程中体现出一些不同。

GET产生一个TCP数据包；POST产生两个TCP数据包。

## socket编程需要什么函数

**基于TCP**

*客户端*

```
创建socket， socket()

连接服务器，connect()

收发数据，send(),recv()

关闭socket，close()
```

*服务端* 

```
创建socket， socket()

绑定IP地址端口信息，bind()

设置监听数量，listen()

接受连接，accept()

收发数据，send(),recv()

关闭socket，close()
```

**基于UDP**

*客户端* 

```
建立套接字文件描述符，socket()

设置服务器地址和端口，struct sockaddr

向服务器发送数据，sendto()

接收服务器的数据，recvfrom()

关闭套接字，close()
```

*服务端*

```
建立套接字文件描述符，使用函数socket()，生成套接字文件描述符。

设置服务器地址和侦听端口，初始化要绑定的网络地址结构。

绑定侦听端口，使用bind()函数，将套接字文件描述符和一个地址类型变量进行绑定。

接收客户端的数据，使用recvfrom()函数接收客户端的网络数据。

向客户端发送数据，使用sendto()函数向服务器主机发送数据。

关闭套接字，使用close()函数释放资源。UDP协议的客户端流程
```

**connect函数**

**send函数**用来向TCP连接的另一端发送数据。客户程序一般用send函数向服务器发送请求，而服务器则通常用send函数来向客户程序发送应答,send的作用是将要发送的数据拷贝到缓冲区，协议负责传输。

**recv函数**用来从TCP连接的另一端接收数据，当应用程序调用recv函数时，recv先等待s的发送缓冲中的数据被协议传送完毕，然后从缓冲区中读取接收到的内容给应用层。

**accept函数**用来接收一个连接，内核维护了半连接队列和一个已完成连接队列，当队列为空的时候，accept函数阻塞，不为空的时候accept函数从上边取下来一个已完成连接，返回一个文件描述符。

## 阻塞、非阻塞、同步、异步

**阻塞和非阻塞**：调用者在事件没有发生的时候，一直在等待事件发生，不能去处理别的任务这是阻塞。调用者在事件没有发生的时候，可以去处理别的任务这是非阻塞。

**同步和异步**：调用者必须循环自去查看事件有没有发生，这种情况是同步。调用者不用自己去查看事件有没有发生，而是等待着注册在事件上的回调函数通知自己，这种情况是异步
